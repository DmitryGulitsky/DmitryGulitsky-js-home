<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>homework</title>
  <script src='http://code.jquery.com/jquery-latest.js'></script>
  <script src="script.js"></script>
</head>
<body>
<div id="page"></div>

<script>
  'use strict';

  window.onhashchange = renderNewState;

  var thirdPageID;

  var page = document.getElementById('page');

  function renderNewState() {
    const hash = window.location.hash;
    var state = decodeURIComponent(hash.substr(1));

    if (state === '') {
      state = {page: 'first'};
    } else {
      state = JSON.parse(state);
    }

    switch(state.page) {
      case 'first':
        var firstPageHeader = document.createElement('h1');
        page.appendChild(firstPageHeader);
        firstPageHeader.className = 'pageHeader';
        firstPageHeader.textContent = 'Энциклопедия';

        var firstPageLink = document.createElement('a');
        page.appendChild(firstPageLink);
        firstPageHeader.className = 'pageLink';
        firstPageLink.textContent = 'список статей здесь';

        firstPageLink.addEventListener('click', function() {
          switchToSecond();
        });
        break;

      case 'second':

        var secondPageHeader = document.createElement('h1');
        page.appendChild(secondPageHeader);
        secondPageHeader.className = 'pageHeader';
        secondPageHeader.textContent = 'Оглавление';

        var linkContainer = document.createElement('div');
        linkContainer.id = 'linkContainer';
        page.appendChild(linkContainer);

        getData();
        break;

      case 'third':

        var thirdPageHeader = document.createElement('h1');
        page.appendChild(thirdPageHeader);
        thirdPageHeader.className = 'pageHeader';
        thirdPageHeader.textContent = 'Название статьи';

        var linkContainer = document.createElement('div');
        page.appendChild(linkContainer);

        var linkContentContainer = document.createElement('div');
        page.appendChild(linkContentContainer);

        $.ajax(AjaxHandlerScript, {
          type: 'GET', dataType: 'json',
          data: {func: 'COURSES_JSON'},
          success: CoursesListReady2, error: ErrorHandler
        });

      function CoursesListReady2(data) {

        var OptionsStr = '';

        var CoursesA = data;

        var byName = CoursesA.slice(0);
        byName.sort(function(a,b) {
          var x = a.name.toLowerCase();
          var y = b.name.toLowerCase();
          return x < y ? -1 : x > y ? 1 : 0;
        });

        for (var C = 0; C < byName.length; C++) {
          var CourseH = byName[C];

          OptionsStr += '<a>' + CourseH.name + '</a><br>';

          }

        GetCourseInfo();

        function GetCourseInfo() {
          var SelectedCourseId = thirdPageID;
          console.log('выбран курс с id=' + SelectedCourseId);
          $.ajax(AjaxHandlerScript,
            {
              type: 'GET', dataType: 'html', data: {func: 'COURSE_INFO', id: thirdPageID},
              success: CourseInfoReady, error: ErrorHandler
            }
          );
        }

        function CourseInfoReady(data) {
          console.log('От сервера получен ответ:');
          console.log(data);
          linkContentContainer.innerHTML = data;
        }
        linkContainer.innerHTML = OptionsStr;
     }
        break;
    }
  }

  function switchToState(state) {
    location.hash = encodeURIComponent(JSON.stringify(state));
  }
  function switchToFirst() {
    switchToState({page: 'first'});
    pageContentRemove();
  }
  function switchToSecond() {
    switchToState({page: 'second'});
    pageContentRemove();
  }
  function switchToThird() {
    switchToState({page: 'third'});
    pageContentRemove();
  }

  function pageContentRemove() {
    while (page.firstChild) {
      page.removeChild(page.firstChild);
    }
  }

  renderNewState();
</script>
</body>
</html>